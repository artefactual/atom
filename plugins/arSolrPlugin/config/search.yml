all:

  server:

    # Server defaults to localhost:9200 if omitted
    host: 'solr1'
    port: 8983
    username: 'solr'
    password: ''
    collection: 'atom'

  index:

    # This is the name of the index; must be unique
    name: atom

    configuration:

      number_of_shards: 4
      number_of_replicas: 1
      index.mapping.total_fields.limit: 3000
      index.max_result_window: 10000

      analysis:

        analyzer:
          default:
            tokenizer: solr.StandardTokenizerFactory
            filter: [lowercase, preserved_asciifolding]

          # This is a special analyzer for autocomplete searches. It's used only
          # in some fields as it can make the index very big.
          # autocomplete:
          #   tokenizer: solr.WhitespaceTokenizerFactory
          #   filter: [lowercase, engram, preserved_asciifolding]

        # # TODO: normalizer, look into solr.PatternReplaceCharFilterFactory
        # normalizer:
        #   # Custom normalizer that lowercases text, removes punctation, and
        #   # does ascii folding for more natural alphabetic sorting
        #   alphasort:
        #     class: custom
        #     filter: [lowercase, preserved_asciifolding, punctuation_filter]

        filter:
          engram:
            class: solr.EdgeNGramFilterFactory
            minGramSize: 3
            maxGramSize: 10
          preserved_asciifolding:
            class: solr.ASCIIFoldingFilterFactory
            preserveOriginal: true
          lowercase:
            class: solr.LowerCaseFilterFactory

        char_filter:
          # This char_filter is added to all analyzers when the index is created
          # and the app_markdown_enabled setting is set to true. Ideally, the
          # Markdown tags should be removed with several regex like
          # in this example: https://github.com/stiang/remove-markdown.
          # But processing all those regex could run very slowly, so
          # we're replacing the following punctuation chars by spaces:
          #     *_#![]()->`+\~:|^=
          strip_md:
            class: solr.PatternReplaceFilterFactory
            pattern: '[\*_#!\[\]\(\)\->`\+\\~:\|\^=]'
            replacement: ' '

          # Strip punctation from a string
          punctuation_filter:
            class: solr.PatternReplaceFilterFactory
            pattern: '["''_\-\?!\.\(\)\[\]#\*`:;]'
            replacement: ''

      # Disable dynamic creation of mappings for unmapped types
      mapper:
        dynamic: false
